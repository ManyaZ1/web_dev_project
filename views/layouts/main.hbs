<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>

    <!-- Core CSS -->
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/air_tickets.css" />
    <link rel="stylesheet" href="/css/tickets.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

    <!-- Optional view-specific CSS -->
    {{#if styles}}
      {{{styles}}}
    {{/if}}
  </head>

  <body>
    <!-- Header -->
    <header class="top-bar">
      <a href="/" class="logo">✈ FlyExpress</a>
      <button class="hamburger" id="hamburgerBtn" aria-label="Toggle Menu">&#9776;</button>
      <nav id="navMenu">
        <ul>
          <li><a href="/tickets">Tickets</a></li>
          <li><a href="/top-destinations">Top Destinations</a></li>
          <li><a href="/about">About us</a></li>
        </ul>
      </nav>
    </header>

    <!-- View Content -->
    {{{body}}}

    <!-- Footer -->
    <footer class="footer">
      © 2025 FlyExpress. All rights reserved.
    </footer>

    <!-- Optional view-specific JS -->
    {{#if script}}
      {{{script}}}
    {{/if}}

    <!-- Animation -->
    <script>
    window.addEventListener('DOMContentLoaded', () => {
        const header = document.querySelector('.top-bar');
        const footer = document.querySelector('.footer');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const navMenu = document.getElementById('navMenu');
        const pageContainer = document.querySelector('.page-container');
        const ticketsContainer = document.querySelector('.tickets-container');
        const overlay = document.getElementById('globeOverlay');

        // Header & Footer Animation (One-Time)
        const hasAnimated = sessionStorage.getItem('headerFooterAnimated');
        if (!hasAnimated) {
            header?.classList.add('fade-in-once');
            sessionStorage.setItem('headerFooterAnimated', 'true');
        } else {
            header?.classList.add('show-instant');
            footer?.classList.add('show-instant');
        }

        // Footer Appearance
        if (footer) {
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        footer.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });
            observer.observe(footer);
        }

        // Hamburger Logic
        hamburgerBtn?.addEventListener('click', () => {
            navMenu.classList.toggle('show');
            hamburgerBtn.classList.toggle('open');
            document.body.style.overflow = navMenu.classList.contains('show') ? 'hidden' : 'auto';
        });

        document.addEventListener('click', (e) => {
            if (!navMenu.contains(e.target) && !hamburgerBtn.contains(e.target)) {
                navMenu.classList.remove('show');
                hamburgerBtn.classList.remove('open');
                document.body.style.overflow = 'auto';
            }
        });

        // Fade-In on Load
        [pageContainer, ticketsContainer].forEach(el => {
            if (el) requestAnimationFrame(() => el.classList.add('fade-in'));
        });

        if (overlay) overlay.classList.add('fade-out'); // Hide overlay after load

        // Fade-Out + Overlay Before Navigation
        document.querySelectorAll('a[href]').forEach(link => {
            const url = new URL(link.href, window.location.origin);

            if (url.origin === window.location.origin) {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Trigger fade-out for content
                    [pageContainer, ticketsContainer].forEach(el => {
                        if (el) {
                            el.classList.remove('fade-in');
                            el.classList.add('fade-out');
                        }
                    });

                    // Bring back overlay immediately
                    if (overlay) overlay.classList.remove('fade-out');

                    setTimeout(() => {
                        window.location.href = link.href;
                    }, 500); // Match transition time
                });
            }
        });
    });
    </script>

  </body>
</html>
